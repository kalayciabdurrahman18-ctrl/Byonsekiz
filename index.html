<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reis PortfÃ¶y Paneli</title>
<style>
body {
    margin: 0;
    padding: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: #020617;
    color: #e5e7eb;
}
.wrapper {
    max-width: 1100px;
    margin: 0 auto;
    padding: 16px;
}
.header {
    background: radial-gradient(circle at top, #1d4ed8 0, #020617 55%);
    border-radius: 16px;
    padding: 20px 20px 16px 20px;
    box-shadow: 0 18px 45px rgba(15,23,42,0.85);
    border: 1px solid rgba(148,163,184,0.25);
}
.header-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
}
.header-title {
    font-size: 20px;
    font-weight: 700;
    letter-spacing: 0.04em;
    color: #e5e7eb;
}
.header-sub {
    font-size: 12px;
    color: #9ca3af;
}
.badge-live {
    background: rgba(34,197,94,0.12);
    color: #bbf7d0;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 11px;
    border: 1px solid rgba(34,197,94,0.4);
    display: inline-flex;
    align-items: center;
    gap: 6px;
}
.badge-dot {
    width: 7px;
    height: 7px;
    border-radius: 999px;
    background: #22c55e;
    box-shadow: 0 0 12px #22c55e;
    animation: pulse 1.4s infinite;
}
@keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    60% { transform: scale(1.55); opacity: 0.1; }
    100% { transform: scale(1); opacity: 1; }
}
.section {
    margin-top: 18px;
}
.card {
    background: rgba(15,23,42,0.96);
    border-radius: 14px;
    border: 1px solid rgba(55,65,81,0.9);
    box-shadow: 0 18px 45px rgba(15,23,42,0.95);
}
.form-card {
    padding: 16px 16px 10px 16px;
}
.section-title {
    font-size: 13px;
    font-weight: 600;
    color: #e5e7eb;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
}
.section-title span {
    font-size: 18px;
}
.form-row {
    display: grid;
    grid-template-columns: 2fr 1.3fr 1.3fr;
    gap: 10px;
}
.input, .btn-primary {
    font-family: inherit;
    font-size: 13px;
    border-radius: 10px;
    border: 1px solid rgba(55,65,81,0.9);
    padding: 9px 10px;
    outline: none;
    transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease, transform 0.05s ease;
}
.input {
    background: radial-gradient(circle at top left, rgba(30,64,175,0.22), rgba(15,23,42,0.98));
    color: #e5e7eb;
}
.input::placeholder {
    color: #6b7280;
}
.input:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 1px rgba(59,130,246,0.35);
}
.btn-primary {
    background: linear-gradient(135deg, #2563eb, #22c55e);
    color: #e5e7eb;
    font-weight: 600;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    border: none;
}
.btn-primary:hover {
    background: linear-gradient(135deg, #1d4ed8, #16a34a);
    transform: translateY(-0.5px);
    box-shadow: 0 10px 30px rgba(37,99,235,0.45);
}
.btn-primary:active {
    transform: translateY(0.5px) scale(0.99);
    box-shadow: 0 4px 10px rgba(15,23,42,0.9);
}
.btn-primary span {
    font-size: 16px;
}
.table-card {
    margin-top: 14px;
    overflow: hidden;
}
.table-scroll {
    max-height: 420px;
    overflow-y: auto;
}
table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
}
th, td {
    padding: 10px 10px;
    text-align: left;
    white-space: nowrap;
}
thead {
    position: sticky;
    top: 0;
    z-index: 2;
}
th {
    background: radial-gradient(circle at top left, rgba(37,99,235,0.4), rgba(15,23,42,1));
    color: #d1d5db;
    font-size: 11px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    border-bottom: 1px solid rgba(55,65,81,0.9);
}
tbody tr:nth-child(even) {
    background: rgba(15,23,42,0.98);
}
tbody tr:nth-child(odd) {
    background: rgba(15,23,42,0.92);
}
tbody tr:hover {
    background: rgba(30,64,175,0.42);
}
.ticker-symbol {
    font-weight: 600;
    letter-spacing: 0.04em;
    color: #e5e7eb;
}
.price-cell {
    font-variant-numeric: tabular-nums;
    color: #e5e7eb;
}
.change-cell {
    font-variant-numeric: tabular-nums;
    font-weight: 600;
}
.change-pos {
    color: #4ade80;
}
.change-neg {
    color: #f97373;
}
.change-flat {
    color: #e5e7eb;
}
.signal-pill {
    display: inline-flex;
    align-items: center;
    padding: 3px 8px;
    border-radius: 999px;
    font-size: 11px;
    border: 1px solid rgba(75,85,99,0.9);
    background: rgba(15,23,42,0.9);
    color: #e5e7eb;
    gap: 6px;
}
.signal-dot {
    width: 6px;
    height: 6px;
    border-radius: 999px;
}
.signal-up {
    background: #22c55e;
    box-shadow: 0 0 8px #22c55e;
}
.signal-flat {
    background: #e5e7eb;
    box-shadow: 0 0 6px rgba(148,163,184,0.7);
}
.signal-down {
    background: #facc15;
    box-shadow: 0 0 8px #facc15;
}
.signal-crash {
    background: #ef4444;
    box-shadow: 0 0 10px #ef4444;
}
.reis-pill {
    display: inline-flex;
    align-items: center;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    gap: 6px;
}
.reis-hold {
    background: rgba(22,163,74,0.2);
    color: #bbf7d0;
    border: 1px solid rgba(34,197,94,0.7);
    box-shadow: 0 0 14px rgba(34,197,94,0.6);
    animation: breathe 1.6s infinite;
}
.reis-add {
    background: rgba(37,99,235,0.22);
    color: #bfdbfe;
    border: 1px solid rgba(59,130,246,0.9);
}
.reis-wait {
    background: rgba(31,41,55,0.9);
    color: #e5e7eb;
    border: 1px solid rgba(75,85,99,1);
}
.reis-careful {
    background: rgba(234,179,8,0.18);
    color: #facc15;
    border: 1px solid rgba(234,179,8,0.9);
}
.reis-sell {
    background: rgba(248,113,113,0.16);
    color: #fecaca;
    border: 1px solid rgba(248,113,113,0.9);
}
@keyframes breathe {
    0% { transform: scale(1); box-shadow: 0 0 10px rgba(34,197,94,0.4); }
    50% { transform: scale(1.03); box-shadow: 0 0 22px rgba(34,197,94,0.9); }
    100% { transform: scale(1); box-shadow: 0 0 10px rgba(34,197,94,0.4); }
}
.btn-delete {
    background: rgba(248,113,113,0.08);
    border-radius: 999px;
    padding: 4px 7px;
    border: 1px solid rgba(248,113,113,0.8);
    color: #fecaca;
    cursor: pointer;
    font-size: 11px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s ease, transform 0.05s ease, box-shadow 0.15s ease;
}
.btn-delete:hover {
    background: rgba(248,113,113,0.35);
    box-shadow: 0 0 16px rgba(248,113,113,0.7);
}
.btn-delete:active {
    transform: translateY(0.5px) scale(0.97);
}
.ticker-tape-card {
    margin-top: 10px;
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid rgba(55,65,81,0.9);
    background: radial-gradient(circle at top left, rgba(37,99,235,0.4), rgba(15,23,42,1));
}
.radar-card {
    margin-top: 22px;
    padding: 16px 16px 14px 16px;
    border-radius: 14px;
    border: 1px solid rgba(250,204,21,0.85);
    background: linear-gradient(135deg, rgba(250,204,21,0.12), rgba(15,23,42,0.98));
    box-shadow: 0 16px 40px rgba(202,138,4,0.35);
}
.radar-title {
    font-size: 13px;
    font-weight: 700;
    color: #facc15;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
}
.radar-badge {
    font-size: 11px;
    padding: 3px 8px;
    border-radius: 999px;
    border: 1px solid rgba(250,204,21,0.8);
    color: #fed7aa;
    background: rgba(30,64,175,0.2);
}
.radar-list {
    list-style: none;
    padding-left: 0;
    margin: 8px 0 0 0;
    font-size: 12px;
    color: #e5e7eb;
}
.radar-list li {
    margin-bottom: 6px;
}
.radar-tag {
    font-weight: 600;
    color: #fde68a;
}
.footer-note {
    margin-top: 14px;
    font-size: 11px;
    color: #9ca3af;
    text-align: right;
}
@media (max-width: 720px) {
    .form-row {
        grid-template-columns: 1.8fr 1.4fr;
        grid-template-rows: auto auto;
    }
    .form-row .btn-primary {
        grid-column: span 2;
    }
    th, td {
        padding: 8px 8px;
        font-size: 11px;
    }
}
</style>
</head>
<body>
<div class="wrapper">
    <div class="header">
        <div class="header-top">
            <div>
                <div class="header-title">ðŸš€ REÄ°S PORTFÃ–Y PANELÄ°</div>
                <div class="header-sub">CanlÄ± fiyat, akÄ±llÄ± sinyal ve REÄ°S aksiyon motoru</div>
            </div>
            <div class="badge-live">
                <span class="badge-dot"></span>
                <span>CanlÄ± Veri Modu</span>
            </div>
        </div>
    </div>

    <div class="section ticker-tape-card">
        <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <script src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
            {
                "symbols": [
                    { "proName": "BIST:XU100", "title": "BIST 100" },
                    { "proName": "BIST:ASELS", "title": "ASELS" },
                    { "proName": "BIST:AKBNK", "title": "AKBANK" },
                    { "proName": "BIST:ASTOR", "title": "ASTOR" },
                    { "proName": "BIST:KONTR", "title": "KONTR" }
                ],
                "showSymbolLogo": true,
                "colorTheme": "dark",
                "isTransparent": true,
                "displayMode": "adaptive",
                "locale": "tr"
            }
            </script>
        </div>
    </div>

    <div class="section card form-card">
        <div class="section-title">
            <span>ðŸ“¥</span>
            <div>Reis'in Hisse Toplama Konsolu</div>
        </div>
        <div class="form-row">
            <input id="symbolInput" class="input" placeholder="Hisse Kodu (Ã¶rn: AKBNK)">
            <input id="noteInput" class="input" placeholder="Opsiyonel Not (Ã¶rn: PortfÃ¶y %5)">
            <button id="addButton" class="btn-primary">
                <span>âž•</span>
                <span>CanlÄ± Fiyat Ã‡ek ve Ekle</span>
            </button>
        </div>
    </div>

    <div class="section card table-card">
        <div class="table-scroll">
            <table>
                <thead>
                    <tr>
                        <th>Hisse Kodu</th>
                        <th>CanlÄ± Fiyat</th>
                        <th>GÃ¼nlÃ¼k DeÄŸiÅŸim</th>
                        <th>Sinyal</th>
                        <th>Reis Aksiyon</th>
                        <th>Not</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <div class="section radar-card">
        <div class="radar-title">
            <span>ðŸŽ¯ REÄ°S'Ä°N GÃ–ZÃœ</span>
            <span class="radar-badge">09:50 RADAR ALANI â€¢ Gemini analizi buraya yazÄ±lacak</span>
        </div>
        <ul class="radar-list" id="radarList">
            <li><span class="radar-tag">Ã–rnek 1:</span> XU100 Ã¼zerinde hacim artÄ±ÅŸÄ± izleniyor, bankalar Ã¶ne Ã§Ä±karsa portfÃ¶y aÄŸÄ±rlÄ±ÄŸÄ± gÃ¶zden geÃ§irilebilir.</li>
            <li><span class="radar-tag">Ã–rnek 2:</span> Defansif hisselerde geri Ã§ekilme alÄ±m fÄ±rsatÄ±na dÃ¶nÃ¼ÅŸebilir, destek seviyeleri takip edilmeli.</li>
            <li><span class="radar-tag">Ã–rnek 3:</span> Teknoloji tarafÄ±nda aÃ§Ä±lÄ±ÅŸta aÅŸÄ±rÄ± yÃ¼kseliÅŸ olursa kÃ¢r realizasyonu senaryosu masada.</li>
        </ul>
    </div>

    <div class="footer-note">
        Veriler localStorage iÃ§inde saklanÄ±r. API cevap vermezse mock veri kullanÄ±lÄ±r, gerÃ§ek seans iÃ§in kendi API anahtarÄ±nÄ± tanÄ±mla.
    </div>
</div>

<script>
var API_KEY = "";
var STORAGE_KEY = "reis_portfoy_v1";
var rows = [];

function loadFromStorage() {
    try {
        var raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
            rows = [];
            return;
        }
        var parsed = JSON.parse(raw);
        if (Array.isArray(parsed)) {
            rows = parsed;
        } else {
            rows = [];
        }
    } catch (e) {
        rows = [];
    }
}

function saveToStorage() {
    try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(rows));
    } catch (e) {
    }
}

function formatPrice(v) {
    if (v === null || v === undefined || isNaN(v)) return "-";
    return Number(v).toFixed(2);
}

function formatChangePercent(v) {
    if (v === null || v === undefined || isNaN(v)) return "-";
    var num = Number(v);
    var sign = num > 0 ? "+" : "";
    return sign + num.toFixed(2) + " %";
}

function classifySignal(change) {
    if (change === null || change === undefined || isNaN(change)) {
        return { label: "Veri Yok", visual: "flat", css: "change-flat" };
    }
    var c = Number(change);
    if (c >= 3) {
        return { label: "GÃ¼Ã§lÃ¼ YÃ¼kseliÅŸ", visual: "up", css: "change-pos" };
    }
    if (c >= 0.5 && c < 3) {
        return { label: "YÃ¼kseliÅŸ", visual: "up", css: "change-pos" };
    }
    if (c > -0.5 && c < 0.5) {
        return { label: "Yatay Seyir", visual: "flat", css: "change-flat" };
    }
    if (c <= -0.5 && c > -3) {
        return { label: "DÃ¼ÅŸÃ¼ÅŸ", visual: "down", css: "change-neg" };
    }
    if (c <= -3) {
        return { label: "Sert DÃ¼ÅŸÃ¼ÅŸ", visual: "crash", css: "change-neg" };
    }
    return { label: "NÃ¶tr", visual: "flat", css: "change-flat" };
}

function classifyReisAction(change) {
    if (change === null || change === undefined || isNaN(change)) {
        return { label: "Veri Bekleniyor", css: "reis-wait" };
    }
    var c = Number(change);
    if (c >= 3) {
        return { label: "Elinde Tut", css: "reis-hold" };
    }
    if (c >= 0 && c < 2) {
        return { label: "Hisse Ekle", css: "reis-add" };
    }
    if (c > -0.5 && c < 0.5) {
        return { label: "Beklemede Kal", css: "reis-wait" };
    }
    if (c <= -1 && c > -3) {
        return { label: "Dikkat Et", css: "reis-careful" };
    }
    if (c <= -4) {
        return { label: "Derhal Sat", css: "reis-sell" };
    }
    return { label: "Beklemede Kal", css: "reis-wait" };
}

function renderTable() {
    var tbody = document.getElementById("tableBody");
    tbody.innerHTML = "";
    for (var i = 0; i < rows.length; i++) {
        var r = rows[i];
        var signal = classifySignal(r.changePercent);
        var reis = classifyReisAction(r.changePercent);
        var tr = document.createElement("tr");

        var changeClass = "change-flat";
        if (signal.css) changeClass = signal.css;

        var signalDotClass = "signal-flat";
        if (signal.visual === "up") signalDotClass = "signal-up";
        else if (signal.visual === "down") signalDotClass = "signal-down";
        else if (signal.visual === "crash") signalDotClass = "signal-crash";

        var reisClass = reis.css + " reis-pill";

        tr.innerHTML =
            '<td><span class="ticker-symbol">' + (r.symbol || "-") + '</span></td>' +
            '<td><span class="price-cell">' + formatPrice(r.price) + '</span></td>' +
            '<td><span class="change-cell ' + changeClass + '">' + formatChangePercent(r.changePercent) + '</span></td>' +
            '<td><span class="signal-pill"><span class="signal-dot ' + signalDotClass + '"></span><span>' + signal.label + '</span></span></td>' +
            '<td><span class="' + reisClass + '">' + reis.label.toUpperCase() + '</span></td>' +
            '<td>' + (r.note ? r.note : "") + '</td>' +
            '<td><button class="btn-delete" data-index="' + i + '">X</button></td>';

        tbody.appendChild(tr);
    }

    var buttons = tbody.querySelectorAll(".btn-delete");
    for (var j = 0; j < buttons.length; j++) {
        buttons[j].onclick = function (ev) {
            var idx = ev.currentTarget.getAttribute("data-index");
            var num = parseInt(idx, 10);
            if (!isNaN(num)) {
                rows.splice(num, 1);
                saveToStorage();
                renderTable();
            }
        };
    }
}

function mockQuote(symbol) {
    var base = Math.random() * 50 + 50;
    var change = Math.round((Math.random() * 10 - 5) * 100) / 100;
    var percent = change;
    var price = base * (1 + percent / 100);
    return {
        symbol: symbol,
        price: price,
        changePercent: percent
    };
}

function fetchFromFinnhub(symbol) {
    if (!API_KEY) {
        return new Promise(function (resolve) {
            resolve(mockQuote(symbol));
        });
    }
    var url = "https://finnhub.io/api/v1/quote?symbol=" + encodeURIComponent(symbol) + "&token=" + encodeURIComponent(API_KEY);
    return fetch(url).then(function (res) {
        if (!res.ok) {
            return mockQuote(symbol);
        }
        return res.json().then(function (data) {
            if (!data || typeof data.c !== "number") {
                return mockQuote(symbol);
            }
            var price = data.c;
            var percent = typeof data.dp === "number" ? data.dp : 0;
            return {
                symbol: symbol,
                price: price,
                changePercent: percent
            };
        }).catch(function () {
            return mockQuote(symbol);
        });
    }).catch(function () {
        return mockQuote(symbol);
    });
}

function handleAdd() {
    var symbolInput = document.getElementById("symbolInput");
    var noteInput = document.getElementById("noteInput");
    var rawSymbol = symbolInput.value.trim();
    if (!rawSymbol) {
        alert("LÃ¼tfen bir hisse kodu gir.");
        return;
    }
    var symbol = rawSymbol.toUpperCase();
    var note = noteInput.value.trim();

    var btn = document.getElementById("addButton");
    var previousText = btn.innerText;
    btn.disabled = true;
    btn.innerText = "Veri Ã§ekiliyor...";

    fetchFromFinnhub(symbol).then(function (q) {
        rows.push({
            symbol: q.symbol,
            price: q.price,
            changePercent: q.changePercent,
            note: note
        });
        saveToStorage();
        renderTable();
        symbolInput.value = "";
        noteInput.value = "";
    }).finally(function () {
        btn.disabled = false;
        btn.innerText = previousText;
    });
}

document.addEventListener("DOMContentLoaded", function () {
    loadFromStorage();
    renderTable();
    var btn = document.getElementById("addButton");
    btn.addEventListener("click", function () {
        handleAdd();
    });
    var symbolInput = document.getElementById("symbolInput");
    symbolInput.addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
            handleAdd();
        }
    });
});
</script>
</body>
</html>
